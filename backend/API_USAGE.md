# MS System API Usage Guide

H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng API cho h·ªá th·ªëng qu·∫£n l√Ω trung t√¢m, d·ª± √°n v√† nh√¢n vi√™n.

## üîë Authentication

### 1. Login ƒë·ªÉ l·∫•y JWT Token

```bash
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**Response:**
```json
{
  "status": "success",
  "message": "Login successful",
  "data": {
    "user": {
      "id": 1,
      "name": "admin",
      "status": "active",
      "role": "admin"
    },
    "staff": {
      "id": 1,
      "gender": "male",
      "phone": "0901234567",
      "center_id": 1
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### 2. S·ª≠ d·ª•ng Token trong c√°c request

```bash
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  http://localhost:5000/api/centers
```

## üè¢ Centers API

### L·∫•y danh s√°ch trung t√¢m

```bash
# L·∫•y t·∫•t c·∫£ trung t√¢m
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/centers"

# L·∫•y v·ªõi pagination
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/centers?page=1&limit=5"

# T√¨m ki·∫øm theo t√™n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/centers?search=c√¥ng ngh·ªá"

# L·ªçc theo lƒ©nh v·ª±c
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/centers?field=C√¥ng ngh·ªá"
```

### T·∫°o trung t√¢m m·ªõi

```bash
curl -X POST http://localhost:5000/api/centers \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Trung t√¢m Nghi√™n c·ª©u AI",
    "field": "Tr√≠ tu·ªá nh√¢n t·∫°o",
    "address": "789 ƒê∆∞·ªùng AI, Qu·∫≠n 9, TP.HCM"
  }'
```

### C·∫≠p nh·∫≠t trung t√¢m

```bash
curl -X PUT http://localhost:5000/api/centers/1 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Trung t√¢m C√¥ng ngh·ªá Th√¥ng tin (C·∫≠p nh·∫≠t)",
    "field": "C√¥ng ngh·ªá th√¥ng tin",
    "address": "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM"
  }'
```

### X√≥a trung t√¢m

```bash
curl -X DELETE http://localhost:5000/api/centers/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### L·∫•y th·ªëng k√™ trung t√¢m

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/centers/1/stats"
```

## üìã Projects API

### L·∫•y danh s√°ch d·ª± √°n

```bash
# L·∫•y t·∫•t c·∫£ d·ª± √°n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/projects"

# L·ªçc theo trung t√¢m
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/projects?center_id=1"

# L·ªçc theo tr·∫°ng th√°i
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/projects?project_status=in_progress"

# T√¨m ki·∫øm theo t√™n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/projects?search=website"
```

### T·∫°o d·ª± √°n m·ªõi

```bash
curl -X POST http://localhost:5000/api/projects \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "H·ªá th·ªëng Qu·∫£n l√Ω Kho",
    "description": "Ph·∫ßn m·ªÅm qu·∫£n l√Ω kho h√†ng v√† t·ªìn kho",
    "center_id": 1,
    "project_status": "planning"
  }'
```

### C·∫≠p nh·∫≠t d·ª± √°n

```bash
curl -X PUT http://localhost:5000/api/projects/1 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "H·ªá th·ªëng Qu·∫£n l√Ω Kho (C·∫≠p nh·∫≠t)",
    "description": "Ph·∫ßn m·ªÅm qu·∫£n l√Ω kho h√†ng v√† t·ªìn kho v·ªõi t√≠nh nƒÉng m·ªõi",
    "center_id": 1,
    "project_status": "in_progress"
  }'
```

### X√≥a d·ª± √°n

```bash
curl -X DELETE http://localhost:5000/api/projects/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## üë• Staff API

### L·∫•y danh s√°ch nh√¢n vi√™n

```bash
# L·∫•y t·∫•t c·∫£ nh√¢n vi√™n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/staff"

# L·ªçc theo trung t√¢m
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/staff?center_id=1"

# L·ªçc theo gi·ªõi t√≠nh
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/staff?gender=male"

# T√¨m ki·∫øm theo s·ªë ƒëi·ªán tho·∫°i
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/staff?search=0901234567"
```

### T·∫°o nh√¢n vi√™n m·ªõi

```bash
curl -X POST http://localhost:5000/api/staff \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": null,
    "gender": "male",
    "phone": "0901234577",
    "address": "123 ƒê∆∞·ªùng MNO, Qu·∫≠n 2, TP.HCM",
    "description": "L·∫≠p tr√¨nh vi√™n Frontend",
    "center_id": 1
  }'
```

### C·∫≠p nh·∫≠t nh√¢n vi√™n

```bash
curl -X PUT http://localhost:5000/api/staff/1 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 1,
    "gender": "male",
    "phone": "0901234567",
    "address": "123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM (C·∫≠p nh·∫≠t)",
    "description": "Qu·∫£n l√Ω trung t√¢m CNTT (C·∫≠p nh·∫≠t)",
    "center_id": 1
  }'
```

### X√≥a nh√¢n vi√™n

```bash
curl -X DELETE http://localhost:5000/api/staff/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## üë§ Users API (Admin Only)

### L·∫•y danh s√°ch ng∆∞·ªùi d√πng

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/users"
```

### T·∫°o ng∆∞·ªùi d√πng m·ªõi

```bash
curl -X POST http://localhost:5000/api/users \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "manager1",
    "password": "manager123",
    "status": "active",
    "role_id": 2
  }'
```

### C·∫≠p nh·∫≠t ng∆∞·ªùi d√πng

```bash
curl -X PUT http://localhost:5000/api/users/2 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "manager1",
    "status": "active",
    "role_id": 2
  }'
```

### Thay ƒë·ªïi m·∫≠t kh·∫©u

```bash
curl -X POST http://localhost:5000/api/auth/change-password \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "currentPassword": "admin123",
    "newPassword": "newadmin123"
  }'
```

## üé≠ Roles API (Admin Only)

### L·∫•y danh s√°ch vai tr√≤

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/roles"
```

### T·∫°o vai tr√≤ m·ªõi

```bash
curl -X POST http://localhost:5000/api/roles \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "supervisor"
  }'
```

## üîó Project Members API

### L·∫•y danh s√°ch th√†nh vi√™n d·ª± √°n

```bash
# L·∫•y t·∫•t c·∫£ th√†nh vi√™n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/project-members"

# L·ªçc theo d·ª± √°n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/project-members?project_id=1"

# L·ªçc theo nh√¢n vi√™n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/project-members?staff_id=1"

# L·ªçc theo tr·∫°ng th√°i
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/project-members?status=active"
```

### Th√™m th√†nh vi√™n v√†o d·ª± √°n

```bash
curl -X POST http://localhost:5000/api/project-members \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "project_id": 1,
    "staff_id": 2,
    "start_time": "2024-04-01T08:00:00.000Z",
    "end_time": null
  }'
```

### C·∫≠p nh·∫≠t th√†nh vi√™n d·ª± √°n

```bash
curl -X PUT http://localhost:5000/api/project-members/1 \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "project_id": 1,
    "staff_id": 1,
    "start_time": "2024-01-01T08:00:00.000Z",
    "end_time": "2024-12-31T17:00:00.000Z"
  }'
```

### ƒê√°nh d·∫•u ho√†n th√†nh

```bash
curl -X POST http://localhost:5000/api/project-members/1/complete \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "end_time": "2024-12-31T17:00:00.000Z"
  }'
```

### X√≥a th√†nh vi√™n kh·ªèi d·ª± √°n

```bash
curl -X DELETE http://localhost:5000/api/project-members/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## üìä Dashboard & Statistics

### L·∫•y th·ªëng k√™ t·ªïng quan

```bash
# Th·ªëng k√™ trung t√¢m
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/centers/1/stats"

# Th·ªëng k√™ d·ª± √°n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/projects/1/stats"

# Th·ªëng k√™ nh√¢n vi√™n
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/staff/1/stats"

# Th·ªëng k√™ vai tr√≤
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/roles/1/stats"
```

## üîç Advanced Queries

### T√¨m ki·∫øm n√¢ng cao

```bash
# T√¨m ki·∫øm trung t√¢m v·ªõi nhi·ªÅu ti√™u ch√≠
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/centers?search=c√¥ng ngh·ªá&field=C√¥ng ngh·ªá&page=1&limit=10&sortBy=name&sortOrder=ASC"

# T√¨m ki·∫øm d·ª± √°n v·ªõi tr·∫°ng th√°i v√† trung t√¢m
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/projects?center_id=1&project_status=in_progress&search=website&page=1&limit=5"

# T√¨m ki·∫øm nh√¢n vi√™n v·ªõi gi·ªõi t√≠nh v√† trung t√¢m
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/staff?center_id=1&gender=male&search=090123&page=1&limit=10"
```

### S·∫Øp x·∫øp v√† ph√¢n trang

```bash
# S·∫Øp x·∫øp theo t√™n tƒÉng d·∫ßn
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/centers?sortBy=name&sortOrder=ASC"

# S·∫Øp x·∫øp theo ng√†y t·∫°o gi·∫£m d·∫ßn
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/projects?sortBy=created_at&sortOrder=DESC"

# Ph√¢n trang v·ªõi 5 items m·ªói trang
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "http://localhost:5000/api/staff?page=2&limit=5"
```

## üö® Error Handling

### Validation Errors

```json
{
  "status": "error",
  "message": "Validation failed",
  "errors": [
    {
      "type": "field",
      "value": "",
      "msg": "Center name must be between 2 and 255 characters",
      "path": "name",
      "location": "body"
    }
  ]
}
```

### Authentication Errors

```json
{
  "status": "error",
  "message": "Access token is required"
}
```

### Authorization Errors

```json
{
  "status": "error",
  "message": "Insufficient permissions"
}
```

### Resource Not Found

```json
{
  "status": "error",
  "message": "Center not found"
}
```

## üì± Frontend Integration

### JavaScript/React Example

```javascript
// Login function
const login = async (username, password) => {
  try {
    const response = await fetch('http://localhost:5000/api/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ username, password }),
    });
    
    const data = await response.json();
    
    if (data.status === 'success') {
      localStorage.setItem('token', data.data.token);
      localStorage.setItem('user', JSON.stringify(data.data.user));
      return data.data;
    } else {
      throw new Error(data.message);
    }
  } catch (error) {
    console.error('Login failed:', error);
    throw error;
  }
};

// API call with authentication
const fetchCenters = async () => {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('http://localhost:5000/api/centers', {
      headers: {
        'Authorization': `Bearer ${token}`,
      },
    });
    
    const data = await response.json();
    return data.data.centers;
  } catch (error) {
    console.error('Failed to fetch centers:', error);
    throw error;
  }
};

// Create center
const createCenter = async (centerData) => {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('http://localhost:5000/api/centers', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(centerData),
    });
    
    const data = await response.json();
    return data.data;
  } catch (error) {
    console.error('Failed to create center:', error);
    throw error;
  }
};
```

### Axios Example

```javascript
import axios from 'axios';

// Create axios instance with base URL
const api = axios.create({
  baseURL: 'http://localhost:5000/api',
});

// Add request interceptor to include token
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// API functions
export const centersAPI = {
  getAll: (params) => api.get('/centers', { params }),
  getById: (id) => api.get(`/centers/${id}`),
  create: (data) => api.post('/centers', data),
  update: (id, data) => api.put(`/centers/${id}`, data),
  delete: (id) => api.delete(`/centers/${id}`),
  getStats: (id) => api.get(`/centers/${id}/stats`),
};

export const projectsAPI = {
  getAll: (params) => api.get('/projects', { params }),
  getById: (id) => api.get(`/projects/${id}`),
  create: (data) => api.post('/projects', data),
  update: (id, data) => api.put(`/projects/${id}`, data),
  delete: (id) => api.delete(`/projects/${id}`),
  getStats: (id) => api.get(`/projects/${id}/stats`),
};

export const staffAPI = {
  getAll: (params) => api.get('/staff', { params }),
  getById: (id) => api.get(`/staff/${id}`),
  create: (data) => api.post('/staff', data),
  update: (id, data) => api.put(`/staff/${id}`, data),
  delete: (id) => api.delete(`/staff/${id}`),
  getStats: (id) => api.get(`/staff/${id}/stats`),
};
```

## üîß Testing v·ªõi Postman

### 1. Import Collection
T·∫°o collection m·ªõi trong Postman v√† import c√°c request sau:

### 2. Environment Variables
```
BASE_URL: http://localhost:5000
TOKEN: (s·∫Ω ƒë∆∞·ª£c set sau khi login)
```

### 3. Pre-request Script cho Login
```javascript
pm.sendRequest({
    url: pm.environment.get("BASE_URL") + "/api/auth/login",
    method: 'POST',
    header: {
        'Content-Type': 'application/json'
    },
    body: {
        mode: 'raw',
        raw: JSON.stringify({
            username: "admin",
            password: "admin123"
        })
    }
}, function (err, response) {
    if (err) {
        console.error(err);
    } else {
        const data = response.json();
        if (data.status === 'success') {
            pm.environment.set("TOKEN", data.data.token);
        }
    }
});
```

### 4. Authorization Header
Trong m·ªói request, th√™m header:
```
Authorization: Bearer {{TOKEN}}
```

## üìã Checklist Testing

- [ ] Authentication endpoints
- [ ] CRUD operations cho Centers
- [ ] CRUD operations cho Projects
- [ ] CRUD operations cho Staff
- [ ] CRUD operations cho Users (Admin only)
- [ ] CRUD operations cho Roles (Admin only)
- [ ] CRUD operations cho Project Members
- [ ] Validation errors
- [ ] Authorization checks
- [ ] Pagination v√† filtering
- [ ] Statistics endpoints
- [ ] Error handling

## üöÄ Performance Tips

1. **Use pagination** cho large datasets
2. **Implement caching** cho frequently accessed data
3. **Optimize database queries** v·ªõi proper indexing
4. **Use compression** middleware
5. **Implement rate limiting** cho production

## üîí Security Best Practices

1. **Always validate input** v·ªõi express-validator
2. **Use HTTPS** trong production
3. **Implement rate limiting** ƒë·ªÉ prevent abuse
4. **Regular security updates** cho dependencies
5. **Monitor API usage** v√† suspicious activities
6. **Use strong JWT secrets** v√† rotate regularly
7. **Implement proper CORS** configuration
8. **Validate file uploads** n·∫øu c√≥
9. **Use parameterized queries** ƒë·ªÉ prevent SQL injection
10. **Implement proper logging** cho security events 